<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>London Bike Rental Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        .map-container {
            height: 60vh;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 p-8">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-4xl font-bold text-center mb-2">London Bike Rental Analysis</h1>
        <p class="text-center text-gray-600 mb-8">An interactive dashboard to explore key usage patterns and popular stations.</p>

        <!-- Filters -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4">Filters</h2>
            <div class="flex flex-col md:flex-row gap-4 items-center">
                <div class="flex-grow">
                    <label class="block text-sm font-medium text-gray-700">Bike ID:</label>
                    <input type="text" id="bikeIdInput" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="Enter Bike ID (e.g., 10000)">
                </div>
                <button onclick="filterByBikeId()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition duration-200">Filter</button>
                <button onclick="resetFilters()" class="bg-gray-400 text-white px-6 py-2 rounded-lg hover:bg-gray-500 transition duration-200">Reset</button>
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                <p class="text-sm font-semibold text-gray-500">Total Trips</p>
                <p id="totalTrips" class="text-3xl font-bold mt-1"></p>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                <p class="text-sm font-semibold text-gray-500">Avg Trip Duration (min)</p>
                <p id="avgDuration" class="text-3xl font-bold mt-1"></p>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                <p class="text-sm font-semibold text-gray-500">Unique Bikes</p>
                <p id="uniqueBikes" class="text-3xl font-bold mt-1"></p>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                <p class="text-sm font-semibold text-gray-500">Unique Stations</p>
                <p id="uniqueStations" class="text-3xl font-bold mt-1"></p>
            </div>
        </div>

        <!-- Map and Charts -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-semibold mb-4">Bike Trip Map</h2>
                <div id="map" class="map-container"></div>
            </div>
            <div class="grid grid-cols-1 gap-8">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-semibold mb-4">Trips by Hour of Day</h2>
                    <canvas id="tripsByHourChart" class="w-full h-full"></canvas>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-semibold mb-4">Top 5 Starting Stations</h2>
                    <canvas id="topStationsChart" class="w-full h-full"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        const bikeData = [
            {"bike_id":10000,"start_station_name":"Hyde Park Corner","start_station_latitude":51.503463,"start_station_longitude":-0.151877,"end_station_name":"Westminster","end_station_latitude":51.499696,"end_station_longitude":-0.124619,"duration":15},
            {"bike_id":10001,"start_station_name":"Covent Garden","start_station_latitude":51.5144,"start_station_longitude":-0.1232,"end_station_name":"Hyde Park Corner","end_station_latitude":51.503463,"end_station_longitude":-0.151877,"duration":25},
            {"bike_id":10002,"start_station_name":"Westminster","start_station_latitude":51.499696,"start_station_longitude":-0.124619,"end_station_name":"Hyde Park Corner","end_station_latitude":51.503463,"end_station_longitude":-0.151877,"duration":10},
            {"bike_id":10003,"start_station_name":"Hyde Park Corner","start_station_latitude":51.503463,"start_station_longitude":-0.151877,"end_station_name":"Covent Garden","end_station_latitude":51.5144,"end_station_longitude":-0.1232,"duration":20},
            {"bike_id":10004,"start_station_name":"Covent Garden","start_station_latitude":51.5144,"start_station_longitude":-0.1232,"end_station_name":"Westminster","end_station_latitude":51.499696,"end_station_longitude":-0.124619,"duration":30},
            {"bike_id":10005,"start_station_name":"Westminster","start_station_latitude":51.499696,"start_station_longitude":-0.124619,"end_station_name":"Hyde Park Corner","end_station_latitude":51.503463,"end_station_longitude":-0.151877,"duration":12},
            {"bike_id":10006,"start_station_name":"Hyde Park Corner","start_station_latitude":51.503463,"start_station_longitude":-0.151877,"end_station_name":"Westminster","end_station_latitude":51.499696,"end_station_longitude":-0.124619,"duration":18},
            {"bike_id":10007,"start_station_name":"Covent Garden","start_station_latitude":51.5144,"start_station_longitude":-0.1232,"end_station_name":"Hyde Park Corner","end_station_latitude":51.503463,"end_station_longitude":-0.151877,"duration":22},
            {"bike_id":10008,"start_station_name":"Hyde Park Corner","start_station_latitude":51.503463,"start_station_longitude":-0.151877,"end_station_name":"Westminster","end_station_latitude":51.499696,"end_station_longitude":-0.124619,"duration":14},
            {"bike_id":10009,"start_station_name":"Westminster","start_station_latitude":51.499696,"start_station_longitude":-0.124619,"end_station_name":"Hyde Park Corner","end_station_latitude":51.503463,"end_station_longitude":-0.151877,"duration":16}
        ];

        let map, bikeMarkers = L.featureGroup();
        let tripsByHourChart, topStationsChart;

        function initializeMap() {
            map = L.map('map').setView([51.505, -0.1], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
        }

        function updateMapMarkers(data) {
            bikeMarkers.clearLayers();
            data.forEach(trip => {
                L.marker([trip.start_station_latitude, trip.start_station_longitude])
                    .bindPopup(`Bike ID: ${trip.bike_id}<br>Start: ${trip.start_station_name}<br>Duration: ${trip.duration} mins`)
                    .addTo(bikeMarkers);
                L.marker([trip.end_station_latitude, trip.end_station_longitude])
                    .bindPopup(`Bike ID: ${trip.bike_id}<br>End: ${trip.end_station_name}<br>Duration: ${trip.duration} mins`)
                    .addTo(bikeMarkers);
            });
            bikeMarkers.addTo(map);
            if (data.length > 0) {
                map.fitBounds(bikeMarkers.getBounds());
            }
        }

        function updateDashboard(data) {
            // Metrics
            document.getElementById('totalTrips').textContent = data.length;
            const totalDuration = data.reduce((sum, trip) => sum + trip.duration, 0);
            document.getElementById('avgDuration').textContent = data.length > 0 ? (totalDuration / data.length).toFixed(1) : 0;
            document.getElementById('uniqueBikes').textContent = new Set(data.map(trip => trip.bike_id)).size;
            document.getElementById('uniqueStations').textContent = new Set(data.flatMap(trip => [trip.start_station_name, trip.end_station_name])).size;

            // Map
            updateMapMarkers(data);

            // Charts
            const tripsByHour = data.reduce((acc, trip) => {
                const hour = new Date().getHours(); // Static hour for demo
                acc[hour] = (acc[hour] || 0) + 1;
                return acc;
            }, {});

            const topStations = data.reduce((acc, trip) => {
                acc[trip.start_station_name] = (acc[trip.start_station_name] || 0) + 1;
                return acc;
            }, {});
            const sortedStations = Object.entries(topStations).sort(([,a],[,b]) => b-a).slice(0, 5);
            const stationLabels = sortedStations.map(s => s[0]);
            const stationData = sortedStations.map(s => s[1]);

            // Trips by Hour Chart
            if (tripsByHourChart) tripsByHourChart.destroy();
            tripsByHourChart = new Chart(document.getElementById('tripsByHourChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: [new Date().getHours()], // Static label for demo
                    datasets: [{
                        label: 'Trips',
                        data: Object.values(tripsByHour),
                        backgroundColor: 'rgba(59, 130, 246, 0.8)',
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });

            // Top Stations Chart
            if (topStationsChart) topStationsChart.destroy();
            topStationsChart = new Chart(document.getElementById('topStationsChart').getContext('2d'), {
                type: 'pie',
                data: {
                    labels: stationLabels,
                    datasets: [{
                        label: 'Trips',
                        data: stationData,
                        backgroundColor: ['#4299E1', '#667EEA', '#9F7AEA', '#D53F8C', '#F687B3'],
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }

        function filterByBikeId() {
            const bikeId = parseInt(document.getElementById('bikeIdInput').value);
            if (!isNaN(bikeId)) {
                const filteredData = bikeData.filter(trip => trip.bike_id === bikeId);
                updateDashboard(filteredData);
            }
        }

        function resetFilters() {
            document.getElementById('bikeIdInput').value = '';
            updateDashboard(bikeData);
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeMap();
            updateDashboard(bikeData);
        });
    </script>
</body>
</html>
